<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DroidScope - UX Exploration Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
      * { font-family: 'Inter', sans-serif; }
      
      :root {
        --bg-primary: #1c1917;
        --bg-secondary: #292524;
        --bg-tertiary: #44403c;
        --border-color: #737373;
        --text-primary: #fafafa;
        --text-secondary: #a8a29e;
        --accent: #78716c;
        --accent-hover: #57534e;
      }

      body {
        background-color: #292524;
        overflow: hidden;
      }

      .grid-background {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image:
          linear-gradient(to right, #a0a0bca6 1px, transparent 1px),
          linear-gradient(to bottom, #9b9bc3be 1px, transparent 1px);
        background-size: 40px 40px;
        -webkit-mask-image: radial-gradient(ellipse 60% 50% at 50% 0%, #f5f0f0 60%, transparent 100%);
        pointer-events: none;
        z-index: 0;
      }

      /* Scrollbar */
      ::-webkit-scrollbar { width: 6px; height: 6px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: #57534e; border-radius: 3px; }
      ::-webkit-scrollbar-thumb:hover { background: #78716c; }

      /* Range slider */
      input[type="range"] {
        -webkit-appearance: none;
        height: 6px;
        background: #3f3f46;
        border-radius: 3px;
      }
      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 16px;
        height: 16px;
        background: #ffffff;
        border-radius: 50%;
        cursor: pointer;
      }

      /* Input styling */
      .input-field {
        background: #1c1917;
        
        padding: 10px 14px;
        color: var(--text-primary);
        width: 100%;
        transition: border-color 0.2s, box-shadow 0.2s;
      }
      .input-field:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 2px rgba(120, 113, 108, 0.1);
      }
      .input-field::placeholder { color: #78716c; }

      /* Result cards */
      .result-card {
        background: #1c1917;
        border: 1px solid var(--border-color);
        border-radius: 10px;
        padding: 16px;
        margin-bottom: 12px;
        transition: border-color 0.2s;
      }
      .result-card:hover { border-color: var(--accent-hover); }

      .badge { padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: 500; }
      .badge-high { background: rgba(239, 68, 68, 0.2); color: #fca5a5; }
      .badge-medium { background: rgba(251, 191, 36, 0.2); color: #fcd34d; }
      .badge-low { background: rgba(34, 197, 94, 0.2); color: #86efac; }
      .badge-good { background: rgba(34, 197, 94, 0.2); color: #86efac; }

      .metric-stat-card {
        background: #1c1917;
        border: 1px solid var(--border-color);
        border-radius: 10px;
        padding: 12px;
        text-align: center;
        transition: border-color 0.2s;
      }
      .metric-stat-card:hover { border-color: var(--accent); }

      /* Stage indicators */
      .stage-indicator {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 0.875rem;
        transition: all 0.3s;
      }
      .stage-pending { background: #44403c; color: #a8a29e; border: 2px solid #57534e; }
      .stage-running { background: #1e40af; color: #93c5fd; border: 2px solid #3b82f6; animation: pulse 2s infinite; }
      .stage-completed { background: #166534; color: #86efac; border: 2px solid #22c55e; }
      .stage-failed { background: #991b1b; color: #fca5a5; border: 2px solid #ef4444; }

      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.6; }
      }

      /* Bottom nav */
      .bottom-nav {
        position: fixed;
        bottom: 24px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(28, 25, 23, 0.95);
        backdrop-filter: blur(10px);
        border: 1px solid var(--border-color);
        border-radius: 16px;
        padding: 8px;
        display: flex;
        gap: 4px;
        z-index: 50;
      }
      .nav-btn {
        padding: 10px 16px;
        border-radius: 10px;
        font-size: 0.875rem;
        font-weight: 500;
        color: #a8a29e;
        background: transparent;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
      }
      .nav-btn:hover { background: #44403c; color: #fafafa; }
      .nav-btn.active { background: #44403c; color: #ffe3e3; }

      .device-indicator {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin-left: 8px;
        animation: pulse-device 2s infinite;
      }
      .device-connected { background: #22c55e; box-shadow: 0 0 8px #22c55e; }
      .device-disconnected { background: #ef4444; box-shadow: 0 0 8px #ef4444; }
      
      @keyframes pulse-device {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }

      /* Library table */
      .library-table th { text-align: left; padding: 12px; color: #a8a29e; font-weight: 500; border-bottom: 1px solid #57534e; }
      .library-table td { padding: 12px; border-bottom: 1px solid #44403c; }
      .library-table tr:hover td { background: #1c1917; }

      /* Terminal */
      .terminal {
        font-family: 'Courier New', monospace;
        font-size: 13px;
        line-height: 1.6;
      }
      .log-info { color: #a8a29e; }
      .log-success { color: #22c55e; }
      .log-warning { color: #f59e0b; }
      .log-error { color: #ef4444; }
      .log-agent { color: #60a5fa; }
    </style>
  </head>
  <body class="h-screen">
    <div class="grid-background"></div>

    <!-- Main Layout -->
    <div class="relative z-10 flex bg-stone-800 h-full">
      <!-- Left Panel -->
      <aside class="fixed left-8 top-8 bottom-8 w-[22rem] flex flex-col gap-6">
        <!-- Header -->
        <div class="bg-stone-900 border border-neutral-500 rounded-2xl px-6 py-5 flex items-center justify-between">
          <h1 class="text-2xl font-bold text-stone-200">DroidScope</h1>
          <button onclick="openSettings()" class="p-2 rounded-xl hover:bg-stone-800 transition-colors" title="Settings">
            <svg
  xmlns="http://www.w3.org/2000/svg"
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
  class="lucide lucide-bolt-icon text-stone-200 lucide-bolt"
>
  <path
    d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"
  />
  <circle cx="12" cy="12" r="4" />
</svg>

          </button>
        </div>

        <!-- Config Form -->
        <div class="bg-stone-900 border border-neutral-500 rounded-2xl flexflex-col">
          <div class="p-3 gap-3 flex flex-col" id="configSection">
            <div class="inline-flex relative bg-stone-800 rounded-xl overflow-hidden items-center">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="lucide text-stone-200  ml-3 lucide-tablet-smartphone-icon lucide-tablet-smartphone"
                >
                <rect width="10" height="14" x="3" y="8" rx="2" />
                <path d="M5 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2h-2.4" />
                <path d="M8 18h.01" />
                </svg>

              <input type="text" id="appName" placeholder="App Name"  class="input-field h-12 bg-stone-800 " />
          </div>
          
          <div class="inline-flex relative bg-stone-800 rounded-xl overflow-hidden items-center">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide text-stone-200 ml-3 lucide-layout-panel-left-icon lucide-layout-panel-left"><rect width="7" height="18" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/></svg>

            <select id="category" class="input-field h-12 bg-stone-800 ">
              <option value="">Select Category</option>
              <option value="Social Media">Social Media</option>
              <option value="E-Commerce">E-Commerce</option>
              <option value="Food Delivery">Food Delivery</option>
              <option value="Productivity">Productivity</option>
              <option value="Entertainment">Entertainment</option>
              <option value="Finance">Finance</option>
              <option value="Health & Fitness">Health & Fitness</option>
              <option value="Education">Education</option>
              <option value="Travel">Travel</option>
              <option value="Gaming">Gaming</option>
              <option value="Messaging">Messaging</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <div class="overflow-hidden inline-flex relative bg-stone-800 items-center rounded-xl">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide ml-3 text-stone-300 lucide-venetian-mask-icon lucide-venetian-mask"><path d="M18 11c-1.5 0-2.5.5-3 2"/><path d="M4 6a2 2 0 0 0-2 2v4a5 5 0 0 0 5 5 8 8 0 0 1 5 2 8 8 0 0 1 5-2 5 5 0 0 0 5-5V8a2 2 0 0 0-2-2h-3a8 8 0 0 0-5 2 8 8 0 0 0-5-2z"/><path d="M6 11c1.5 0 2.5.5 3 2"/></svg>

            
            <select id="persona" class="input-field h-12 bg-stone-800 rounded-xl">
              <option value="">Select Persona</option>
              <option value="UX Designer">UX Designer</option>
              <option value="QA Engineer">QA Engineer</option>
              <option value="Product Manager">Product Manager</option>
            </select>
          </div>
          <div>
            
            <textarea id="customNavigation" placeholder="e.g., Go to profile, then settings..." rows="2" class="input-field bg-stone-800 rounded-xl resize-none"></textarea>
          </div>


          <!-- Hidden depth field with default value -->
          <input type="hidden" id="maxDepth" value="8" />

          <div class="flex items-center gap-2">
            <input type="checkbox" id="saveToMemory" checked class="w-4 h-4 rounded border-stone-600 bg-stone-900 text-white focus:ring-0" />
            <label for="saveToMemory" class="text-sm text-stone-400">Save to library</label>
          </div>

          <button onclick="startTest()" id="startBtn" class="w-full py-3 bg-stone-500 hover:bg-stone-600 text-stone-200 font-semibold rounded-xl transition-colors">
            Start Exploration
          </button>
        </div>

        <!-- Console Logs -->
    </div>
    <div class="bg-stone-900 border border-neutral-500 rounded-2xl h-full flex flex-col ">
     <div class="px-2 py-2  gap-3 flex items-center w-full h-full flex-col justify-between">
       <span class="text-sm font-medium items-center px-2 pt-2 flex justify-between w-full text-stone-400">
        <span class="flex gap-2 items-center">

            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-terminal-icon lucide-terminal"><path d="M12 19h8"/><path d="m4 17 6-6-6-6"/></svg>
    
            Console
        </span>
           <div class="flex gap-2">
             <button id="stopBtn" onclick="stopAgent()" class="hidden px-2 py-1 text-xs border border-red-600 text-red-400 rounded hover:bg-red-600 hover:text-white transition-colors">Stop</button>
             <button onclick="clearLogs()" class="px-2 py-1 text-xs border border-stone-600 text-stone-400 rounded hover:bg-stone-700 transition-colors">Clear</button>
           </div>
       </span>
       <div id="terminalOutput" class="terminal bg-stone-900 h-full w-full  overflow-y-auto rounded-3xl border-t-1 border-neutral-500 p-3 bg-stone-950">
         <div class="text-stone-500">[00:00:00] Waiting for exploration...</div>
       </div>
     </div>
        
      </aside>

      <!-- Right Content Area -->
      <div class="flex-1 ml-[26rem] w-[32] overflow-y-auto pb-24">
        <!-- Scan Section -->
        <div id="scanSection" class="p-8">
          <h2 class="text-2xl font-bold text-white mb-6">Exploration Progress</h2>
          
          <!-- Stage Indicators -->
          <div class="flex items-center justify-center gap-4 mb-8">
            <div class="flex flex-col items-center">
              <div id="stage1" class="stage-indicator stage-pending">1</div>
              <span class="text-xs text-stone-500 mt-2">Basic</span>
            </div>
            <div class="w-12 h-0.5 bg-stone-700"></div>
            <div class="flex flex-col items-center">
              <div id="stage2" class="stage-indicator stage-pending">2</div>
              <span class="text-xs text-stone-500 mt-2">Persona</span>
            </div>
            <div class="w-12 h-0.5 bg-stone-700"></div>
            <div class="flex flex-col items-center">
              <div id="stage3" class="stage-indicator stage-pending">3</div>
              <span class="text-xs text-stone-500 mt-2">Stress</span>
            </div>
            <div class="w-12 h-0.5 bg-stone-700"></div>
            <div class="flex flex-col items-center">
              <div id="stage4" class="stage-indicator stage-pending">4</div>
              <span class="text-xs text-stone-500 mt-2">Analysis</span>
            </div>
          </div>

          <!-- Progress Bar -->
          <div class="bg-stone-900 border border-stone-700 rounded-lg p-6 mb-6">
            <div class="flex items-center justify-between mb-2">
              <span id="progressMessage" class="text-stone-300">Ready to start...</span>
              <span id="progressPercent" class="text-white font-semibold">0%</span>
            </div>
            <div class="h-2 bg-stone-800 rounded-full overflow-hidden">
              <div id="progressBar" class="h-full bg-gradient-to-r from-white to-stone-300 transition-all duration-500" style="width: 0%"></div>
            </div>
          </div>

          <!-- Current Stage Info -->
          <div id="currentStageInfo" class="bg-stone-900 border border-stone-700 rounded-lg p-6 ">
            <h3 class="text-lg font-semibold text-white mb-2">Current Stage</h3>
            <p id="stageDescription" class="text-stone-400"></p>
          </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="p-8 hidden">
          <h2 class="text-2xl font-bold text-white mb-6">Analysis Results</h2>
          
          <!-- Summary -->
          <div class="bg-stone-900 border border-stone-700 rounded-lg p-6 mb-6">
            <h3 class="text-lg font-semibold text-white mb-3">Executive Summary</h3>
            <div id="summaryContent" class="text-stone-300 leading-relaxed"></div>
          </div>

          <!-- Metrics Grid -->
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6" id="metricsGrid"></div>

          <!-- Charts -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div class="bg-stone-900 border border-stone-700 rounded-lg p-4">
              <canvas id="depthChart"></canvas>
            </div>
            <div class="bg-stone-900 border border-stone-700 rounded-lg p-4">
              <canvas id="severityChart"></canvas>
            </div>
            <div class="bg-stone-900 border border-stone-700 rounded-lg p-4">
              <canvas id="scoreChart"></canvas>
            </div>
          </div>

          <!-- Positive Findings -->
          <div class="bg-stone-900 border border-stone-700 rounded-lg p-6 mb-6">
            <h3 class="text-lg font-semibold text-white mb-4">Strengths & Good UX</h3>
            <div id="positiveContent"></div>
          </div>

          <!-- Issues -->
          <div class="bg-stone-900 border border-stone-700 rounded-lg p-6 mb-6">
            <h3 class="text-lg font-semibold text-white mb-4">Issues Found</h3>
            <div id="issuesContent"></div>
          </div>

          <!-- Recommendations -->
          <div class="bg-stone-900 border border-stone-700 rounded-lg p-6 mb-6">
            <h3 class="text-lg font-semibold text-white mb-4">Recommendations</h3>
            <div id="recommendationsContent"></div>
          </div>

          <!-- Dark Patterns (conditionally shown) -->
          <div id="darkPatternsSection" class="bg-red-950 border border-red-800 rounded-lg p-6 mb-6 hidden">
            <h3 class="text-lg font-semibold text-red-300 mb-4">⚠️ Dark Patterns Detected</h3>
            <div id="darkPatternsContent"></div>
          </div>

          <!-- Persona Insights -->
          <div class="bg-stone-900 border border-stone-700 rounded-lg p-6 mb-6">
            <h3 class="text-lg font-semibold text-white mb-4">Persona Insights</h3>
            <div id="personaInsightsContent"></div>
          </div>

          <!-- Actions -->
          <div class="flex gap-4">
            <button onclick="downloadReport()" class="flex-1 py-3 bg-stone-800 hover:bg-stone-700 text-white font-semibold rounded-lg border border-stone-600 transition-colors">
              Download Report
            </button>
            <button onclick="resetExploration()" class="flex-1 py-3 bg-stone-800 hover:bg-stone-700 text-white font-semibold rounded-lg border border-stone-600 transition-colors">
              New Exploration
            </button>
          </div>
        </div>

        <!-- Library Section -->
        <div id="librarySection" class="p-8 hidden">
          <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold text-white">Results Library</h2>
            <div class="flex gap-2">
              <select id="libraryCategory" onchange="loadLibrary()" class="input-field text-sm">
                <option value="">All Categories</option>
                <option value="Social Media">Social Media</option>
                <option value="E-Commerce">E-Commerce</option>
                <option value="Food Delivery">Food Delivery</option>
                <option value="Productivity">Productivity</option>
                <option value="Entertainment">Entertainment</option>
              </select>
              <select id="libraryPersona" onchange="loadLibrary()" class="input-field text-sm">
                <option value="">All Personas</option>
                <option value="UX Designer">UX Designer</option>
                <option value="QA Engineer">QA Engineer</option>
                <option value="Product Manager">Product Manager</option>
              </select>
            </div>
          </div>
          
          <div class="bg-stone-900 border border-stone-700 rounded-lg overflow-hidden">
            <table class="w-full library-table">
              <thead>
                <tr class="bg-stone-800">
                  <th>App Name</th>
                  <th>Category</th>
                  <th>Persona</th>
                  <th>UX Score</th>
                  <th>Date</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="libraryTable"></tbody>
            </table>
          </div>
          
          <div id="libraryPagination" class="flex justify-center gap-2 mt-4"></div>
        </div>

        <!-- Compare Section -->
        <div id="compareSection" class="p-8 hidden">
          <h2 class="text-2xl font-bold text-white mb-6">Compare Results</h2>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div>
              <label class="block text-sm text-stone-400 mb-1">Category</label>
              <select id="compareCategory" onchange="loadComparison()" class="input-field">
                <option value="">Select Category</option>
                <option value="Social Media">Social Media</option>
                <option value="E-Commerce">E-Commerce</option>
                <option value="Food Delivery">Food Delivery</option>
                <option value="Productivity">Productivity</option>
                <option value="Entertainment">Entertainment</option>
              </select>
            </div>
            <div>
              <label class="block text-sm text-stone-400 mb-1">Persona</label>
              <select id="comparePersona" onchange="loadComparison()" class="input-field">
                <option value="">Select Persona</option>
                <option value="UX Designer">UX Designer</option>
                <option value="QA Engineer">QA Engineer</option>
                <option value="Product Manager">Product Manager</option>
              </select>
            </div>
          </div>

          <div id="comparisonContent" class="space-y-6">
            <p class="text-stone-500 text-center py-12">Select category and persona to compare results</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
      <button class="nav-btn active" onclick="showSection('scan', this)">Scan</button>
      <button class="nav-btn" onclick="showSection('results', this)">Results</button>
      <button class="nav-btn" onclick="showSection('library', this)">Library</button>
      <button class="nav-btn" onclick="showSection('compare', this)">Compare</button>
      <div class="flex items-center px-3">
        <span class="text-xs text-stone-500">Device</span>
        <div id="deviceIndicator" class="device-indicator device-disconnected"></div>
      </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 hidden">
      <div class="bg-stone-900 border border-stone-700 rounded-xl p-6 w-full max-w-md">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-xl font-bold text-white">Settings</h2>
          <button onclick="closeSettings()" class="text-stone-400 hover:text-white">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        
        <div class="space-y-4">
          <div>
            <label class="block text-sm text-stone-400 mb-1">API Key</label>
            <input type="password" id="settingsApiKey" class="input-field" />
          </div>
          <div>
            <label class="block text-sm text-stone-400 mb-1">LLM Model</label>
            <input type="text" id="settingsModel" value="mistralai/devstral-2512:free" class="input-field" />
          </div>
          <div>
            <label class="block text-sm text-stone-400 mb-1">API Base URL</label>
            <input type="text" id="settingsApiBase" value="https://openrouter.ai/api/v1" class="input-field" />
          </div>
          <button onclick="saveSettings()" class="w-full py-3 bg-stone-200 hover:bg-stone-300 text-stone-900 font-semibold rounded-lg transition-colors">
            Save Settings
          </button>
        </div>
      </div>
    </div>

    <script src="{{ url_for('static', filename='script_new.js') }}"></script>
  </body>
</html>
